# Начало обучения

## Цели главы

Цели данной главы: настроить рабочее окружение для разработки на PureScript и написать первую программу.

Нашим первым проектом будет простая библиотека, предоставляющая единственную функцию для вычиcления диагонали прямоугольного треугольника.

## Введение

Вот те инструменты которые мы будем использовать для разработки на PureScript: 

- [`psc`](http://purescript.org) - сам компилятор PureScript.
- [`npm`](http://npmjs.org) - менеджер пакетов для nodejs, который позволит установить оставшуюся часть инструментов.
- [`Pulp`](https://github.com/bodil/pulp) - консольное приложение, автоматизирующие множество различных задач, связанных с управлением PureScript проектами.

Оставшаяся часть главы поможет вам установить и настроить эти инструменты. 

## Установка PureScript

Рекомендуемый способ установки компилятора PureScript - это скачать бинарный релиз для вашей платформы [с сайта PureScript](http://purescript.org).

Вам необходимо убедиться в том, что компилятор PureScript доступен в переменной PATH. Попробуйте запустить его в командной строке для проверки:

```text
$ psc
```

Другие способы установки компилятора:

- Использовать популярный менеджер пакетов, такой как NPM или Homebrew (на MacOS).
- Собрать компилятор из исходников. Инструкции можно найти на сайте PureScript.

## Установка инструментов

Необходимо установить [NodeJS](http://nodejs.org/), если у вас не установлена эта платформа. Вместе с ней также установится менеджер пакетов `npm`. Убедитесь в том, что `npm` установлен и доступен в PATH.

Вам также необходимо установить консольную утилиту Pulp и менеджер пакетов Bower, используя `npm`:

```text
$ npm install -g pulp bower
```

Это команда поместит `pulp` и `bower` так, что они будут доступны в PATH. Теперь у вас должны быть все необходимые инструменты для создания вашего первого PureScript проекта.

## Hello, PureScript!

Начнем с простого. Используем Pulp для компиляции и запуска простой Hello World! программы.

Начнем с создания проекта в пустой директории, используя команду `pulp init`:

```text
$ mkdir my-project
$ cd my-project
$ pulp init

* Generating project skeleton in ~/my-project

$ ls

bower.json	src		test
```

Pulp создал для нас две директории - `src` и `test`, а также конфигурационный файл `bower.json`. Директория `src` будет содержать наши исходники, а `test` - наши тесты. Директорию `test` мы будем использовать позднее в книге.

Измените содержимое файла `src/Main.purs` на это:

```haskell
module Main where

import Control.Monad.Eff.Console

main = log "Hello, World!"
```
Этот небольшой пример иллюстрирует несколько ключевых идей:

- Каджый файл начинается с заголовка модуля. Имя модуля состоит из одного или нескольких слов, начинающихся с заглавной буквы, и разделенных точками. В нашем случае используется одно слово, но имя `My.First.Module` тоже будет считаться правильным.
- Модули импортируются, используя их полные имена, включая точки, разделяющие части имени модуля. Здесь мы импортируем модуль `Control.Monad.Eff.Console`, который предоставляет функцию `log`.
- Программа `main` определена как применение функции. В PureScript применение функции отображается как название функции, отделенное пробелами от её аргументов.

Давайте соберем и запустим проект, используя следующую команду:

```text
$ pulp run

* Building project in ~/my-project
* Build successful.
Hello, World!
```
Поздравляю! Вы только что скомпилировали и запустили вашу первую PureScript программу!

## Компилирование для браузера

Pulp может быть использован для создания из PureScript кода на Javascript, подходящего для браузера, через вызов команды `pulp browserify`:

```text
$ pulp browserify

* Browserifying project in ~/my-project
* Building project in ~/my-project
* Build successful.
* Browserifying...
```

После этого вы должны увидеть в консоли большой объем кода на Javascript. Это результат работы программы [Browserify](http://browserify.org/), которая была применена к стандартной библиотеке PureScript _Prelude_, а так же к коду в директории `src`. Javascript код может быть сохранен в файл и включен в HTML документ. Если вы это сделаете, то увидите фразу "Hello, World!", выведенную в консоли браузера.

## Удаление неиспользуемого кода

Pulp предоставляет альтернативную команду - `pulp build`, которая может быть использована с опцией `-O` для удаления неиспользуемого кода (dead code elimination) из вывода. Результирующий код будет гораздо меньше:

```text
$ pulp build -O --to output.js

* Building project in ~/my-project
* Build successful.
* Bundling Javascript...
* Bundled.
```

И опять, генерируемый код может быть использован в HTML документе. Если вы откроете `output.js` вы должны увидеть несколько скомпилированных модулей, которые выглядят примерно так:

```javascript
(function(exports) {
  "use strict";

  var Control_Monad_Eff_Console = PS["Control.Monad.Eff.Console"];

  var main = Control_Monad_Eff_Console.log("Hello, World!");
  exports["main"] = main;
})(PS["Main"] = PS["Main"] || {});
```

Это иллюстрирует несколько моментов реализации генерации кода компилятором PureScript:

- Каждый модуль становится объектом, создаваемым оборачивающей функцией, который содержит экспортируемые члены модуля.
- PureScript пытается сохранить имена переменных где это возможно.
- Применение функций в PureScript преобразовывается в применение функций в JavaScript.
- Метод main запускается после того, как все модули будут определены, и генерируется в виде простого вызова метода без аргументов.
- код PureScript не зависит ни от какой runtime библиотеки. Весь код, сгенерированный компилятором порожден каким-то модулем на PureScript, от которого зависит ваш код.

Эти важные моменты показывают то, что PureScript генерирует простой и понятный код. Фактически, процесс кодогенерации представляет собой довольно небольшое преобразование. Требуется сравнительно небольшое понимание языка, чтобы предугадать какой Javascript будет сгенерирован для определенного входного кода.

## Компилирование модулей CommonJS

Pulp может быть также использован для генерации модулей CommonJS из PureScript кода. Это может быть полезно во время использования NodeJS, или просто для разработки большого проекта, который использует модули CommonJS, для разбиения кода на меньшие компоненты.

Чтобы создать модули CommonJS, используйте команду `pulp build` (без опции `-O`):

```text
$ pulp build

* Building project in ~/my-project
* Build successful.
```

Сгенерированный код по умолчанию будет помещен в папку `output`. Каждый модуль PureScript будет скомпилирован в свой собственный модуль CommonJS и помещен в свою собственную поддиректорию.

## Отслеживание зависимостей с Bower

Чтобы написать функцию `diagonal` (цель данной главы), нам необходимо иметь возможность вычислять квадратные корни. Пакет `purescript-math` содержит определения типов для функций, определенных в JavaScript объекте `Math`, поэтому, давайте установим его:

```text
$ bower install purescript-math --save
```

Опция `--save` добавляет зависимость в конфигурационный файл `bower.json`

Исходники библиотеки `purescript-math` должны быть теперь доступны в поддиректории `bower_components`, и будут подключены, когда вы будете компилировать проект.

## Вычисление диагоналей

Давайте напишем функцию `diagonal`, которая будет примером использования функции из внешней библиотеки.

Во-первых, импортируем модуль `Math`, добавив следующие строки в начало файла `src/Main.purs`:

```haskell
import Math (sqrt)
```

Также необходимо добавить модуль `Prelude`, который определяет самые базовые операции, такие как числовое сложение и умножение:

```haskell
import Prelude
```

Теперь определим функцию `diagonal` следущим образом: 

```haskell
diagonal w h = sqrt (w * w + h * h)
```

Обратим внимание, что здесь нет необходимости определять тип функции. Компилятор способен сделать вывод что `diagonal` это функция, которая берёт два числа и возвращает число. В целом, однако, это хорошая практика - аннотировать код типами, считая это формой документации.

Давайте также изменим функцию `main` для использования новой функции `diagonal`:

```haskell
main = logShow (diagonal 3.0 4.0)
```

Теперь опять скомпилируем и запустим проект, используя `pulp run`:

```text
$ pulp run

* Building project in ~/my-project
* Build successful.
5.0
```

## Тестирование кода с использованием интерактивного режима

Компилятор PureScript поставляется также вместе с интерактивным REPL под названием PSCi. Это может быть очень полезно для тестирования кода и для экспериментирования с новыми идеями. Давате используем PSCi чтобы проверить функцию `diagonal`:

Pulp может загрузить исходники модулей в psci автоматически, через команду `pulp psci`:

```text
$ pulp psci
>
```

Вы можете увидеть список команд, напечатав `:?`:

```text
> :?
The following commands are available:

    :?                        Show this help menu
    :quit                     Quit PSCi
    :reset                    Reset
    :browse      <module>     Browse <module>
    :type        <expr>       Show the type of <expr>
    :kind        <type>       Show the kind of <type>
    :show        import       Show imported modules
    :show        loaded       Show loaded modules
    :paste       paste        Enter multiple lines, terminated by ^D
```

Нажав на Tab, вы должны будете увидеть список всех доступных функций в вашем коде, во всех зависимостях из Bower, а также в модулях Prelude:

Начнем с импорта модуля `Prelude`:

```text
> import Prelude
```

Теперь попробуем вычислить несколько выражений:

```text
> 1 + 2
3

> "Hello, " <> "World!"
"Hello, World!"
```

Давайте попробуем нашу новую функцию `diagonal` в PSCi.


```text
> import Main
> diagonal 5.0 12.0

13.0
```

Вы можете также использовать PSCi для определения новых функций:

```text
> let double x = x * 2

> double 10
20
```

Не беспокойтесь, если синтаксис этих примеров вам сейчас не ясен - он приобретет больше смысла по ходу чтения книги.

Наконец, вы можете проверить тип выражения, используя команду `:type`:

```text
> :type true
Boolean

> :type [1, 2, 3]
Array Int
```

Теперь попробуйте интерактивный режим. Если вы где-то застряли, просто воспользуйтесь командой `:reset` для выгрузки всех модулей, скомпилированных в памяти.

X> ## Упражнения
X>
X> 1. (Легко) Используя константу `Math.pi`, напишите функцию `circleArea`, вычисляющую площадь круга по заданному радиусу. Проверьте функцию, используя PSCi (_Подсказка_: не забудьте импортировать `pi`, изменив инструкцию `import Math`)
X> 1. (Средне) Используя `bower install` установите пакет `purescript-globals` в качестве зависимости. Проверьте его функции в PSCi (_Подсказка_: вы можете воспользоваться командой `:browse` в PSCi, чтобы просмотреть содержимое модуля)

## Заключение

В этой главе мы создали простой PureScript проект использовав инструмент Pulp

Мы также написали нашу первую PureScript функцию, а также JavaScript программу, которая может быть скомпилирована и запущена, и в браузере, и на NodeJS

Мы будем использовать эту рабочую конфигурацию в последующих главах для компиляции, отладки и запуска нашего кода, поэтому вы должны убедиться, что чувствуете себя комфортно с используемыми инструментами и техниками.

<p align="center">
    <a href = "https://github.com/ashgaliyev/purescript-book-ru/blob/master/text/chapter1.md" title="Предыдущая глава">&#129092</a>
    <a href = "https://github.com/ashgaliyev/purescript-book-ru/blob/master/text/chapter3.md" title = "Следующая глава">&#129094</a>
</p>
